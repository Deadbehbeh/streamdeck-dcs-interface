<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport"
    content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui,viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <title>com.ctytler.streamdeck.dcs Property Inspector</title>
  <link rel="stylesheet" href="css/sdpi.css" />
</head>

<body>
  <div class="sdpi-wrapper">
    <!-- DROP HTML-STUFF BELOW -->

    <!--
            Here we just copied a couple of elements from the PISamples example, which contains
            a huge collection pre-made HTML-elements for you to use.
            Important here is (if you plan to communicate from the Property Inspector to the plugin without
            further programming), that you add an 'id' to an element's control. 
            This will get the 'key', which is sent to the plugin (or settings), along with the value of
            the control.
          -->

    <div class="sdpi-item">
      <div class="sdpi-item-label">Settings</div>
      <!-- Note - "Save" button does not actually do anything just makes sure user deselects boxes to save all info.-->
      <button class="sdpi-item-value" id="save_settings_button">
        Save Settings
      </button>
      <button class="sdpi-item-value" id="external_help_window_button" onclick="callbackHelpButtonPress()">
        Help
      </button>
    </div>

    <details>
      <summary>DCS Command (on Button Press) Settings</summary>

      <div class="sdpi-item">
        <div class="sdpi-item-label">Button ID</div>
        <input id="button_id" class="sdpi-item-value" type="text" value=""
          placeholder="Button ID number of clickable data" />
      </div>

      <div class="sdpi-item">
        <div class="sdpi-item-label">Device ID</div>
        <input id="device_id" class="sdpi-item-value" type="text" value=""
          placeholder="Device ID number of clickable data" />
      </div>

      <div class="sdpi-item">
        <div class="sdpi-item-label">Send Value while Released</div>
        <input id="release_value" class="sdpi-item-value" type="text" value="" placeholder="Example: 0" />
      </div>

      <div class="sdpi-item">
        <div class="sdpi-item-label">Send Value while Pressed</div>
        <input id="press_value" class="sdpi-item-value" type="text" value="" placeholder="Example: 1" />
      </div>
    </details>

    <details>
      <summary>DCS Function Monitor (Change Button Image) Settings</summary>

      <div class="sdpi-item">
        <div class="sdpi-item-label">DCS ID</div>
        <input id="export_id_value_monitor" class="sdpi-item-value" type="text" value=""
          placeholder="DCS ID number of Function to Monitor" />
      </div>

      <div class="sdpi-item" id="select_change_condition">
        <div class="sdpi-item-label">Show 2nd State Image When</div>
        <select class="sdpi-item-value select" id="change_condition_input">
          <option value="==">is equal to (==) below value</option>
          <option value="<">is less than (<) below value</option>
          <option value=">">is greater than (>) below value</option>
        </select>
      </div>

      <div class="sdpi-item">
        <div class="sdpi-item-label">Value</div>
        <input id="condition_value_input" class="sdpi-item-value" type="text" value=""
          placeholder="Specify condition value" />
      </div>
    </details>

    <details>
      <summary>DCS Function Text Update Monitor Settings</summary>

      <div class="sdpi-item">
        <div class="sdpi-item-label">DCS ID</div>
        <input id="export_id_string_monitor" class="sdpi-item-value" type="text" value=""
          placeholder="DCS ID number of Function to Monitor" />
      </div>
    </details>

    <!-- END OF SDPI-WRAPPER -->
  </div>

  <div class="sdpi-info-label hidden" style="top: -1000;" value=""></div>
  <script src="js/common.js"></script>
  <script src="js/common_pi.js"></script>
  <script src="js/index_pi.js"></script>

  <script>
    /**
     * @function callbackHelpButtonPress
     * Opens an external window when button is clicked.
     */
    function callbackHelpButtonPress() {
      if (!window.xtWindow || window.xtWindow.closed) {
        window.xtWindow = window.open('../helpDocs/helpWindow.html', 'External Window');
      }
    }


    /**
     * @function sendEventToPlugin
     * Sends a JSON payload with a specified event string to the plugin.
     * 
     * These messages are handled within the plugin via MyStreamDeckPlugin::SendToPlugin()
     * where the event field can be used to identify appropriate action to take.
     * 
     * @param {String} event String used to identify the reason for sending message.
     * @param {Json} inPayload Payload containing data to be transferred to plugin.
     */
    function sendEventToPlugin(event, inPayload) {
      if ($SD.connection && $SD.connection.readyState === 1) {
        inPayload.event = event;
        const json = {
          action: $SD.actionInfo['action'],
          event: 'sendToPlugin',
          context: $SD.uuid,
          payload: inPayload
        }
        $SD.connection.send(JSON.stringify(json));
      }
    }

    /**
     * @function registerExportIdUpdate
     * Callback function that will send updated "export_id_*" value from the Property Inspector
     * to the plugin whenever a user changes the field in order to register/unregister that
     * export_id for DCS monitoring.
     * 
     * @param {String} updated_item ID for the spdi item in the Property Inspector which was updated.
     * @param {String} updated_value New value set by Streamdeck user.
     */
    function registerExportIdUpdate(updated_item, updated_value) {
      console.log("Register DCS ID: ", updated_item, updated_value);
      if (!isNaN(updated_value)) {
        var payload = {
          key: updated_item,
          value: updated_value,
        }
        sendEventToPlugin('updateRegisteredExportId', payload)
      }
    }
  </script>

  }
</body>

</html>